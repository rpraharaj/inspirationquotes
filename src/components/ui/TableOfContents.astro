---
/**
 * TableOfContents Component
 * 
 * Auto-generates table of contents from markdown headings
 */
interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  headings: Heading[];
  title?: string;
}

const { headings, title = 'Table of Contents' } = Astro.props;

// Filter to only H2 and H3 headings for cleaner TOC
const filteredHeadings = headings.filter(h => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <nav class="toc p-6 border border-border rounded-xl bg-background-secondary" aria-label="Table of contents">
    <h2 class="text-sm font-bold uppercase tracking-wider text-foreground-tertiary mb-4">
      {title}
    </h2>
    <ul class="space-y-2">
      {filteredHeadings.map((heading) => (
        <li class:list={[heading.depth === 3 && 'ml-4']}>
          <a 
            href={`#${heading.slug}`}
            class:list={[
              'block py-1 text-sm transition-colors duration-200 hover:text-foreground',
              heading.depth === 2 ? 'text-foreground-secondary font-medium' : 'text-foreground-tertiary'
            ]}
          >
            {heading.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<style>
  .toc a {
    position: relative;
  }
  
  .toc a:hover::before {
    content: '';
    position: absolute;
    left: -12px;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 4px;
    background: var(--text-primary);
    border-radius: 50%;
  }
</style>

<script>
  // Highlight active section on scroll
  document.addEventListener('DOMContentLoaded', () => {
    const tocLinks = document.querySelectorAll('.toc a');
    const headings = document.querySelectorAll('h2[id], h3[id]');
    
    if (tocLinks.length === 0 || headings.length === 0) return;
    
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.getAttribute('id');
            tocLinks.forEach((link) => {
              link.classList.remove('toc-active');
              if (link.getAttribute('href') === `#${id}`) {
                link.classList.add('toc-active');
              }
            });
          }
        });
      },
      { rootMargin: '-80px 0px -80% 0px' }
    );
    
    headings.forEach((heading) => observer.observe(heading));
  });
</script>

<style is:global>
  .toc-active {
    color: var(--text-primary) !important;
    font-weight: 600;
  }
</style>
